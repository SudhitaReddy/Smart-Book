<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Detail - Smart Book</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/styles.css" />
  <style>
    .sidebar-menu {
      position: fixed; top:0; right:-300px; width:300px; height:100%;
      background:#fff; box-shadow:-2px 0 8px rgba(0,0,0,.15);
      transition:right .3s ease; z-index:2000; padding:18px;
    }
    .sidebar-menu.show { right:0; }
    .sidebar-close { position:absolute; top:8px; right:12px; font-size:22px; cursor:pointer; }
    .sidebar-menu a { display:block; padding:10px 0; color:#333; text-decoration:none; }
    .sidebar-menu a:hover { color:#0d6efd; }

    .product-detail img {
      max-width: 100%;
      border-radius: 8px;
    }
    .product-actions {
      margin-top: 15px;
    }
    .wishlist-btn {
      margin-left: 10px;
    }
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-custom sticky-top">
  <div class="container">
    <a class="navbar-brand" href="index.html"><h4>Smart Book</h4></a>

    <button class="navbar-toggler" type="button" aria-label="Menu" onclick="toggleSidebar()">
      <i class="fa fa-bars"></i>
    </button>

    <div class="collapse navbar-collapse" id="navbarContent">
      <div class="mx-auto search-bar">
        <form class="d-flex" onsubmit="searchBooks(event)">
          <input id="searchInput" class="form-control search-input" type="search" placeholder="Search books, authors, categories..." />
          <button class="btn search-btn" type="submit"><i class="fa fa-search"></i></button>
        </form>
      </div>

      <div class="icon-links d-flex ms-lg-auto mt-3 mt-lg-0">
        <!-- Profile -->
        <div class="profile-menu">
          <a href="#" onclick="toggleProfileMenu(event)"><i class="fa fa-user"></i></a>
          <div class="profile-menu-content" id="profileMenu"></div>
        </div>

        <!-- Wishlist -->
        <a href="wishlist.html"><i class="fa fa-heart"></i></a>

        <!-- Cart -->
        <div class="cart-menu position-relative">
          <a href="cart.html" class="cart-icon">
            <i class="fa fa-shopping-cart"></i>
            <span class="cart-count">0</span>
          </a>
          <div class="cart-preview shadow-sm" id="cartPreview"></div>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Sidebar -->
<div class="sidebar-menu" id="sidebarMenu">
  <span class="sidebar-close" onclick="toggleSidebar()">&times;</span>
  <h5 class="mb-3">Browse Categories</h5>
  <a href="products.html" onclick="toggleSidebar()">All</a>
  <a href="products.html?category=fiction" onclick="toggleSidebar()">ðŸ“– Fiction</a>
  <a href="products.html?category=non-fiction" onclick="toggleSidebar()">ðŸ“˜ Non-Fiction</a>
  <a href="products.html?category=education" onclick="toggleSidebar()">ðŸ“š Education</a>
  <hr />
  <a href="wishlist.html"><i class="fa fa-heart"></i> Wishlist</a>
  <a href="cart.html"><i class="fa fa-shopping-cart"></i> Cart</a>
  <a href="orders.html"><i class="fa fa-box"></i> Orders</a>
  <a href="login.html"><i class="fa fa-user"></i> Login</a>
  <a href="signup.html"><i class="fa fa-user-plus"></i> Sign Up</a>
</div>

<!-- PRODUCT DETAIL -->
<div class="container my-5">
  <div id="productDetail" class="product-detail"></div>
</div>

<!-- FOOTER -->
<footer class="footer">
  <div class="footer-container">
    <div class="footer-section">
      <h4>Smart Book</h4>
      <p>Your trusted online bookstore for fiction, non-fiction, and educational books.</p>
    </div>
    <div class="footer-section">
      <h4>Quick Links</h4>
      <ul>
        <li><a href="products.html?category=fiction">Fiction</a></li>
        <li><a href="products.html?category=non-fiction">Non-Fiction</a></li>
        <li><a href="products.html?category=education">Education</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h4>Customer Service</h4>
      <ul>
        <li><a href="contact.html">Contact Us</a></li>
        <li><a href="#shipping">Shipping Info</a></li>
        <li><a href="#returns">Returns</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h4>Connect With Us</h4>
      <div class="social-links">
        <a href="#"><i class="fab fa-facebook"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <p>&copy; 2025 Smart Book. All rights reserved.</p>
  </div>
</footer>

<script src="js/script.js"></script>
<script>
 async function loadProductDetail() {
  const urlParams = new URLSearchParams(window.location.search);
  const productId = urlParams.get("id");

  if (!productId) {
    document.getElementById("productDetail").innerHTML = "<p>Invalid product</p>";
    return;
  }

  let response = await apiRequest(`${API_BASE_URL}/products/${productId}`, "GET", null, false);

  // âœ… Normalize: always extract the actual product object
  let product = null;
  if (response && response.data && response.data.product) {
    product = response.data.product;
  }

  if (!product) {
    document.getElementById("productDetail").innerHTML = "<p>Product not found</p>";
    return;
  }

  document.getElementById("productDetail").innerHTML = `
    <div class="row">
      <div class="col-md-5">
        <img src="${product.images?.[0]?.url || 'https://placehold.co/400x500?text=Book'}" 
             alt="${product.title}">
      </div>
      <div class="col-md-7">
        <h2>${product.title}</h2>
        <p class="text-muted">by ${product.author || "Unknown"}</p>
        <h4 class="text-primary mb-3">â‚¹${product.price}</h4>
        <p>${product.description || "No description available."}</p>
        <div class="product-actions">
          <button class="btn btn-primary" onclick="addToCart('${product._id}')">
            <i class="fa fa-shopping-cart"></i> Add to Cart
          </button>
          <button class="btn btn-outline-danger wishlist-btn" onclick="addToWishlist('${product._id}')">
            <i class="fa fa-heart"></i> Add to Wishlist
          </button>
        </div>
      </div>
    </div>
  `;
}

  document.addEventListener("DOMContentLoaded", loadProductDetail);
</script>
</body>
</html>
