<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Signup - My E-commerce</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-light">

<div class="container d-flex justify-content-center align-items-center min-vh-100">
  <div class="card shadow-lg p-4 w-100" style="max-width: 420px;">
    <h3 class="text-center mb-3">Register</h3>

    <form id="signupForm">
      <div class="mb-3">
        <label for="name" class="form-label">Full Name</label>
        <input type="text" id="name" class="form-control" required>
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" id="email" class="form-control" required>
      </div>

      <div class="mb-3">
        <label for="mobile" class="form-label">Mobile Number</label>
        <input type="text" id="mobile" class="form-control" required>
      </div>

      <div class="mb-3">
        <label for="password" class="form-label">Password</label>
        <input type="password" id="password" class="form-control" required>
        <small class="text-muted">Min 8 chars, must include uppercase, lowercase, number & special char</small>
      </div>

      <div class="mb-3">
        <label for="confirmPassword" class="form-label">Confirm Password</label>
        <input type="password" id="confirmPassword" class="form-control" required>
      </div>

      <!-- OTP input (hidden until sent) -->
      <div class="mb-3 d-none" id="otpDiv">
        <label for="otp" class="form-label">Enter OTP</label>
        <input type="text" id="otp" class="form-control" placeholder="Enter OTP sent to your email">
        <button type="button" id="verifyOtpBtn" class="btn btn-success mt-2 w-100">Verify OTP</button>
        <button type="button" id="resendOtpBtn" class="btn btn-secondary mt-2 w-100">Resend OTP</button>
        <small id="otpTimer" class="text-muted d-block mt-1">OTP expires in 5:00</small>
      </div>

      <button type="submit" id="signupBtn" class="btn btn-primary w-100">Send OTP</button>
    </form>

    <p id="message" class="text-center mt-3"></p>

    <p class="text-center mt-3">
      Already have an account? <a href="login.html" class="text-decoration-none">Login</a>
    </p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/auth.js"></script>
<!-- <script>
const signupForm = document.getElementById("signupForm");
const signupBtn = document.getElementById("signupBtn");
const otpDiv = document.getElementById("otpDiv");
const verifyOtpBtn = document.getElementById("verifyOtpBtn");
const resendOtpBtn = document.getElementById("resendOtpBtn");
const otpTimer = document.getElementById("otpTimer");
const message = document.getElementById("message");

let otpCountdown = 300; // 5 min in seconds
let timerInterval = null;

// Helper function to start OTP countdown
function startOtpTimer() {
  clearInterval(timerInterval);
  otpCountdown = 300;
  otpTimer.innerText = `OTP expires in 5:00`;

  timerInterval = setInterval(() => {
    otpCountdown--;
    const minutes = String(Math.floor(otpCountdown / 60)).padStart(1, "0");
    const seconds = String(otpCountdown % 60).padStart(2, "0");
    otpTimer.innerText = `OTP expires in ${minutes}:${seconds}`;

    if (otpCountdown <= 0) {
      clearInterval(timerInterval);
      message.style.color = "red";
      message.innerText = "OTP expired. Please resend.";
      signupBtn.disabled = false;
      resendOtpBtn.disabled = false;
    }
  }, 1000);
}

// Send OTP// Step 1: Send OTP (only email)
async function sendOtp() {
  message.innerText = "";

  const email = document.getElementById("email").value.trim();
  if (!email) {
    message.style.color = "red";
    message.innerText = "Email is required";
    return false;
  }

  try {
    const res = await fetch("http://localhost:5000/api/auth/send-otp-email", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })   // ✅ only send email
    });

    const data = await res.json();
    message.style.color = data.success ? "green" : "red";
    message.innerText = data.message;

    if (data.redirect) {
      // ✅ redirect if account already exists
      alert(data.message);
      window.location.href = data.redirect;
      return false;
    }

    if (data.success) {
      otpDiv.classList.remove("d-none");
      signupBtn.disabled = true;
      resendOtpBtn.disabled = true;
      document.getElementById("otp").focus();
      startOtpTimer();
      return true;
    }
  } catch (err) {
    message.style.color = "red";
    message.innerText = "Server error, try again.";
    return false;
  }
}

// Step 1: Initial send OTP
signupForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  await sendOtp();
});

// Step 2: Verify OTP & complete registration
// Step 2: Verify OTP & complete registration
verifyOtpBtn.addEventListener("click", async () => {
  const formData = {
    name: document.getElementById("name").value.trim(),
    email: document.getElementById("email").value.trim(),
    mobile: document.getElementById("mobile").value.trim(),
    password: document.getElementById("password").value,
    otp: document.getElementById("otp").value.trim()
  };

  if (!formData.otp) {
    message.style.color = "red";
    message.innerText = "Please enter OTP";
    return;
  }

  try {
    const res = await fetch("http://localhost:5000/api/auth/verify-otp-email", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(formData)   // ✅ send all signup data + otp
    });

    const data = await res.json();
    message.style.color = data.success ? "green" : "red";
    message.innerText = data.message;

    if (data.success) {
      clearInterval(timerInterval);
      alert("Signup successful! Redirecting to login...");
      window.location.href =  "frontend/login.html";

    }
  } catch (err) {
    message.style.color = "red";
    message.innerText = "Server error, try again.";
  }
});

resendOtpBtn.addEventListener("click", async () => {
  resendOtpBtn.disabled = true;
  const success = await sendOtp();
  if (!success) {
    resendOtpBtn.disabled = false;
  }
});
</script> -->
</body>
</html>
