<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Products - Smart Book</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/styles.css" />
  <style>
    /* Sidebar */
    .sidebar-menu {
      position: fixed; top:0; right:-300px; width:300px; height:100%;
      background:#fff; box-shadow:-2px 0 8px rgba(0,0,0,.15);
      transition:right .3s ease; z-index:2000; padding:18px;
    }
    .sidebar-menu.show { right:0; }
    .sidebar-close { position:absolute; top:8px; right:12px; font-size:22px; cursor:pointer; }
    .sidebar-menu a { display:block; padding:10px 0; color:#333; text-decoration:none; }
    .sidebar-menu a:hover { color:#0d6efd; }

    /* Product Grid */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
    }
    .product-card {
      border: 1px solid #eee;
      border-radius: 8px;
      overflow: hidden;
      background: #fff;
      text-align: center;
      transition: transform 0.2s;
      position: relative;
    }
    .product-card:hover { transform: translateY(-3px); }
    .product-card img {
      width: 100%; height: 250px; object-fit: cover;
    }
    .product-info { padding: 12px; }
    .wishlist-btn {
      position: absolute;
      top: 10px; right: 10px;
      background: #fff;
      border: none;
      border-radius: 50%;
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      cursor: pointer;
    }
    .wishlist-btn:hover {
      background: #f8d7da;
      color: #dc3545;
    }
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-custom sticky-top">
  <div class="container">
    <a class="navbar-brand" href="index.html"><h4>Smart Book</h4></a>

    <button class="navbar-toggler" type="button" aria-label="Menu" onclick="toggleSidebar()">
      <i class="fa fa-bars"></i>
    </button>

    <div class="collapse navbar-collapse" id="navbarContent">
      <div class="mx-auto search-bar">
        <form class="d-flex" onsubmit="searchBooks(event)">
          <input id="searchInput" class="form-control search-input" type="search" placeholder="Search books, authors, categories..." />
          <button class="btn search-btn" type="submit"><i class="fa fa-search"></i></button>
        </form>
      </div>

      <div class="icon-links d-flex ms-lg-auto mt-3 mt-lg-0">
        <!-- Profile -->
        <div class="profile-menu">
          <a href="#" onclick="toggleProfileMenu(event)"><i class="fa fa-user"></i></a>
          <div class="profile-menu-content" id="profileMenu"></div>
        </div>

        <!-- Wishlist -->
        <a href="wishlist.html"><i class="fa fa-heart"></i></a>

        <!-- Cart -->
        <div class="cart-menu position-relative">
          <a href="cart.html" class="cart-icon">
            <i class="fa fa-shopping-cart"></i>
            <span class="cart-count">0</span>
          </a>
          <div class="cart-preview shadow-sm" id="cartPreview"></div>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Sidebar -->
<div class="sidebar-menu" id="sidebarMenu">
  <span class="sidebar-close" onclick="toggleSidebar()">&times;</span>
  <h5 class="mb-3">Browse Categories</h5>
  <a href="products.html" onclick="toggleSidebar()">All</a>
  <a href="products.html?category=fiction" onclick="toggleSidebar()">ðŸ“– Fiction</a>
  <a href="products.html?category=non-fiction" onclick="toggleSidebar()">ðŸ“˜ Non-Fiction</a>
  <a href="products.html?category=education" onclick="toggleSidebar()">ðŸ“š Education</a>
  <hr />
  <a href="wishlist.html"><i class="fa fa-heart"></i> Wishlist</a>
  <a href="cart.html"><i class="fa fa-shopping-cart"></i> Cart</a>
  <a href="orders.html"><i class="fa fa-box"></i> Orders</a>
  <a href="login.html"><i class="fa fa-user"></i> Login</a>
  <a href="signup.html"><i class="fa fa-user-plus"></i> Sign Up</a>
</div>

<!-- PRODUCTS GRID -->
<div class="container my-5">
  <div class="products-grid" id="productsGrid"></div>
</div>

<!-- FOOTER -->
<footer class="footer">
  <div class="footer-container">
    <div class="footer-section">
      <h4>Smart Book</h4>
      <p>Your trusted online bookstore for fiction, non-fiction, and educational books.</p>
    </div>
    <div class="footer-section">
      <h4>Quick Links</h4>
      <ul>
        <li><a href="products.html?category=fiction">Fiction</a></li>
        <li><a href="products.html?category=non-fiction">Non-Fiction</a></li>
        <li><a href="products.html?category=education">Education</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h4>Customer Service</h4>
      <ul>
        <li><a href="contact.html">Contact Us</a></li>
        <li><a href="#shipping">Shipping Info</a></li>
        <li><a href="#returns">Returns</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h4>Connect With Us</h4>
      <div class="social-links">
        <a href="#"><i class="fab fa-facebook"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <p>&copy; 2025 Smart Book. All rights reserved.</p>
  </div>
</footer>

<script src="js/script.js"></script>
<script>
  async function loadProducts() {
  let response = await apiRequest(`${API_BASE_URL}/products`, "GET", null, false);

  // âœ… Ensure we always extract the array
  let products = [];
  if (response && response.data && Array.isArray(response.data.products)) {
    products = response.data.products;
  }

  allProducts = products;
  const grid = document.getElementById("productsGrid");

  if (!allProducts.length) {
    grid.innerHTML = "<p>No products found.</p>";
    return;
  }

  grid.innerHTML = allProducts.map(p => `
    <div class="product-card">
      <button class="wishlist-btn" onclick="addToWishlist('${p._id}')">
        <i class="fa fa-heart"></i>
      </button>
      <div class="product-image">
        <a href="product-detail.html?id=${p._id}">
          <img src="${p.images?.[0]?.url || 'https://placehold.co/200x300?text=Book'}" alt="${p.title}">
        </a>
      </div>
      <div class="product-info">
        <h6><a href="product-detail.html?id=${p._id}">${p.title}</a></h6>
        <p class="text-muted">${p.author || "Unknown"}</p>
        <p>â‚¹${p.price}</p>
        <button class="btn btn-sm btn-primary" onclick="addToCart('${p._id}')">Add to Cart</button>
      </div>
    </div>
  `).join("");
}

  document.addEventListener("DOMContentLoaded", loadProducts);
</script>
</body>
</html>
